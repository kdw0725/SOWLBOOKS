<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sowl.sowlbooks.bookMapper">
	<select id="bookList" resultType="bookVO">
		SELECT 
							@rownum:=@rownum+1 NO,
							BOOK_NO, 
							BOOK_NAME, 
							BOOK_AUTHOR, 
							BOOK_PUBLISHER
		FROM 
							BOOK,
							(SELECT @rownum:=0) r
		WHERE
							BOOK_DELFLAG = 0
		<include refid="search"/>
		ORDER BY
							NO DESC
		LIMIT
							#{pageStart}, #{perPageNum}
	</select>
	
	<select id="countBook" parameterType="hashMap" resultType="Integer">
		SELECT 
							COUNT(BOOK_NO) 
		FROM 
							BOOK
		WHERE
							BOOK_DELFLAG = 0
		<include refid="search"/>
	</select>
	
	<sql id="search">
		<if test="keyword != null">
		AND
							BOOK_NAME LIKE CONCAT('%', #{keyword}, '%')
		OR
							BOOK_AUTHOR LIKE CONCAT('%',#{keyword},'%')
		OR
							BOOK_PUBLISHER LIKE CONCAT('%', #{keyword},'%')
		
		</if>
	</sql>
	
	<insert id="insertBook" parameterType="bookVO">
		INSERT
		INTO
							BOOK
							(
							BOOK_NAME,
							BOOK_AUTHOR,
							BOOK_PUBLISHER,
							BOOK_NO
							)
		VALUES
							(
							#{book_name},
							#{book_author},
							#{book_publisher},
							#{book_no}
							)
	</insert>
	
	<insert id="insertFile" parameterType="fileVO">
		INSERT
		INTO
							FILE
							(
							BOOK_NO,
							FILE_NAME,
							FILE_ORI_NAME,
							FILE_URL
							)
		VALUES
							(
							#{ book_no},
							#{ file_name},
							#{ file_ori_name},
							#{ file_url}
							)
	
	</insert>
</mapper>