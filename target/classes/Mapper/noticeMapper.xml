<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sowl.sowlbooks.noticeMapper">
	<select id="notice" parameterType="hashMap" resultType="noticeVO">
		SELECT
							@rownum:=@rownum+1 No,
							NOTICE_NO,
							NOTICE_TITLE,
							NOTICE_CONTENT,
							DATE_FORMAT(NOTICE_INSERTDATE, '%Y-%m-%d') AS NOTICE_INSERTDATE,
							NOTICE_WRITER
		FROM 
							NOTICE,
							(SELECT @rownum:=0) r
		WHERE
							NOTICE_DELFLAG = 0
		<include refid="search"/>
		ORDER BY
							NO DESC
		LIMIT
							#{pageStart}, #{perPageNum}
	</select>
	
	<select id="countNotice" resultType="Integer">
		SELECT
							COUNT(NOTICE_NO)
		FROM
							NOTICE
		WHERE
							NOTICE_DELFLAG = 0
	</select>
	
	<select id="selectNotice" parameterType="int" resultType="noticeVO">
		SELECT 
							NOTICE_NO,
							NOTICE_TITLE, 
							NOTICE_CONTENT, 
							NOTICE_INSERTDATE,
							NOTICE_WRITER
		FROM 
							NOTICE 
		WHERE 
							NOTICE_NO = #{ notice_no}
		AND
							NOTICE_DELFLAG = 0
	</select>
	
	<insert id="noticeInsert" parameterType="noticeVO">
		INSERT 
		INTO 
							NOTICE
							(
							NOTICE_TITLE, 
							NOTICE_CONTENT, 
							NOTICE_WRITER
							) 
		VALUES
							(
							#{ notice_title},
							#{ notice_content},
							#{ notice_writer}
							)
	</insert>
	
	<update id="noticeUpdate" parameterType="noticeVO">
		UPDATE 
							NOTICE 
		SET 
							NOTICE_TITLE = #{ notice_title}, 
							NOTICE_CONTENT = #{ notice_content}, 
							NOTICE_INSERTDATE = NOW() 
		WHERE 
							NOTICE_NO = #{ notice_no}
	</update>
	
	<update id="noticeDelete" parameterType="int">
		UPDATE
							NOTICE
		SET
							NOTICE_DELFLAG = 1
		WHERE
							NOTICE_NO = #{ notice_no}
	</update>
	
	<sql id="search">
		<if test="keyword != null">
		AND
							NOTICE_TITLE LIKE CONCAT('%', #{keyword}, '%')
		OR
							NOTICE_CONTENT LIKE CONCAT('%',#{keyword},'%')
		OR
							NOTICE_WRITER LIKE CONCAT('%', #{keyword},'%')
		
		</if>
	</sql>
</mapper>